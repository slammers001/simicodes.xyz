<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PokÃ©mon Chess</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            color: #e74c3c;
            margin-bottom: 20px;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background-color: #333;
            padding: 5px;
            border-radius: 5px;
        }
        
        .square {
            aspect-ratio: 1/1;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .light {
            background-color: #f0d9b5;
        }
        
        .dark {
            background-color: #b58863;
        }
        
        .selected {
            box-shadow: inset 0 0 0 3px #3498db;
        }
        
        .last-move {
            background-color: #a3e4a3 !important;
        }
        
        .in-check {
            box-shadow: inset 0 0 0 3px #e74c3c;
        }
        
        .piece {
            width: 80%;
            height: 80%;
            object-fit: contain;
        }
        
        .status {
            font-size: 1.2rem;
            margin: 20px 0;
            font-weight: bold;
            min-height: 2rem;
        }
        
        .pokemon-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .pokemon-option {
            background-color: #f8f8f8;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .pokemon-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #e74c3c;
        }
        
        .pokemon-option img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }
        
        .pokemon-option h3 {
            margin: 10px 0 5px;
        }
        
        .pokemon-option p {
            margin: 0;
            color: #666;
        }
        
        button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
            margin-top: 20px;
        }
        
        button:hover {
            background-color: #c0392b;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        
        .modal h2 {
            color: #e74c3c;
            margin-top: 0;
        }
        
        .name-input {
            margin: 30px 0;
        }
        
        .name-input input {
            padding: 10px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            width: 100%;
            max-width: 300px;
        }
        
        .name-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .hidden {
            display: none;
        }
        
        .difficulty-selector {
            margin: 20px 0;
        }
        
        .difficulty-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .difficulty-selector select {
            padding: 8px;
            font-size: 1rem;
            border-radius: 5px;
            border: 2px solid #ddd;
        }

        .captured-pieces {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px;
            min-height: 50px;
            justify-content: center;
        }

        .captured-piece-img {
            width: 30px;
            height: 30px;
            object-fit: contain;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .advantage-display {
            font-weight: bold;
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .promotion-types {
            margin-top: 20px;
        }

        .type-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .type-option {
            padding: 10px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .type-option:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PokÃ©mon Chess</h1>
        
        <div id="name-screen">
            <div class="name-input">
                <label for="player-name">Enter your name:</label>
                <input type="text" id="player-name" placeholder="Pokemon Trainer">
            </div>
            <div class="difficulty-selector">
                <label for="difficulty">Select Difficulty:</label>
                <select id="difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <button id="start-game">Start Game</button>
        </div>
        
        <div id="pokemon-selection-screen" class="hidden">
            <h2>Choose Your PokÃ©mon King</h2>
            <div class="pokemon-selection" id="pokemon-selection"></div>
        </div>
        
        <div id="game-screen" class="hidden">
            <div class="status" id="game-status"></div>
            <div class="advantage-display" id="advantage-display"></div>
            <div class="captured-pieces" id="computer-captured"></div>
            <div class="board" id="chess-board"></div>
            <div class="captured-pieces" id="player-captured"></div>
        </div>
    </div>

    <div id="promotion-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Choose Evolution</h2>
            <div id="evolution-options" class="pokemon-selection"></div>
            <div class="promotion-types">
                <h3>Choose Piece Type</h3>
                <div class="type-options">
                    <button class="type-option" data-type="queen">Queen</button>
                    <button class="type-option" data-type="rook">Rook</button>
                    <button class="type-option" data-type="bishop">Bishop</button>
                    <button class="type-option" data-type="knight">Knight</button>
                </div>
            </div>
        </div>
    </div>

    <div id="congrats-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="result-title">ðŸŽ‰ Congratulations! ðŸŽ‰</h2>
            <p id="result-message"></p>
            <button id="play-again">Play Again</button>
        </div>
    </div>

    <script>
        // Chess Game Implementation
        const starterPokemon = [
            {
                id: 6,
                name: "Charizard",
                type: "fire",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png",
            },
            {
                id: 130,
                name: "Gyarados",
                type: "water",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/130.png",
            },
            {
                id: 640,
                name: "Virizion",
                type: "grass",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/640.png",
            },
            {
                id: 1018,
                name: "Archaludon",
                type: "dragon",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1018.png",
            },
            {
                id: 150,
                name: "Mewtwo",
                type: "psychic",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png",
            },
            {
                id: 312,
                name: "Minun",
                type: "electric",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/312.png",
            },
            {
                id: 94,
                name: "Gengar",
                type: "ghost",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/94.png",
            },
            {
                id: 185,
                name: "Sudowoodo",
                type: "rock",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/185.png",
            },
            {
                id: 143,
                name: "Snorlax",
                type: "normal",
                imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png",
            }
        ];

        const pokemonEvolutions = {
            513: [ // Pansear
                { id: 514, name: "Simisear" },
                
            ],
            393: [ // Piplup
                { id: 394, name: "Prinplup" },
                { id: 395, name: "Empoleon" }
            ],
            102: [ // Exeggcute
                { id: 103, name: "Exeggutor" }
            ],
            885: [ // Dreepy
                { id: 886, name: "Drakloak" },
                { id: 887, name: "Dragapult" }
            ],
            174: [ // Igglybuff
                { id: 39, name: "Jigglypuff" },
                { id: 40, name: "Wigglytuff" }
            ],
            403: [ // Shinx
                { id: 404, name: "Luxio" },
                { id: 405, name: "Luxray" }
            ],
            971: [ // Greavard
                { id: 972, name: "Houndstone" },
                
            ],
            529: [ // Drilbur
                { id: 530, name: "Excadrill" },
            ],
            133: [ // Eevee
                { id: 134, name: "Vaporeon" },
                { id: 135, name: "Jolteon" },
                { id: 136, name: "Flareon" },
                { id: 196, name: "Espeon"},
                { id: 197, name: "Umbreon"},
                { id: 470, name: "Leafeon"},
                { id: 471, name: "Glaceon"},
                { id: 700, name: "Sylveon"}
            ]
        };

        const pokemonTeams = {
            charizard: {
                king: {...starterPokemon[0], role: 'king' },
                queen: { id: 38, name: "Ninetales", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/38.png", role: 'queen' },
                bishops: [
                    { id: 909, name: "Fuecoco", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/909.png", role: 'bishop' },
                    { id: 909, name: "Fuecoco", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/909.png", role: 'bishop' }
                ],
                knights: [
                    { id: 255, name: "Torchic", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/255.png", role: 'knight' },
                    { id: 255, name: "Torchic", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/255.png", role: 'knight' }
                ],
                rooks: [
                    { id: 667, name: "Litleo", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/667.png", role: 'rook' },
                    { id: 667, name: "Litleo", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/667.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 513, name: "Pansear", type: "fire", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/513.png", role: 'pawn' })
            },
            gyarados: {
                king: {...starterPokemon[1], role: 'king' },
                queen: { id: 350, name: "Milotic", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/350.png", role: 'queen' },
                bishops: [
                    { id: 647, name: "Keldeo", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/647.png", role: 'bishop' },
                    { id: 647, name: "Keldeo", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/647.png", role: 'bishop' }
                ],
                knights: [
                    { id: 183, name: "Marill", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/183.png", role: 'knight' },
                    { id: 183, name: "Marill", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/183.png", role: 'knight' }
                ],
                rooks: [
                    { id: 363, name: "Spheal", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/363.png", role: 'rook' },
                    { id: 363, name: "Spheal", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/363.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 393, name: "Piplup", type: "water", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/393.png", role: 'pawn' })
            },
            virizion: {
                king: { ...starterPokemon[2], role: 'king' },
                queen: { id: 585, name: "Deerling", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/585.png", role: 'queen' },
                bishops: [
                    { id: 420, name: "Cherubi", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/420.png", role: 'bishop' },
                    { id: 420, name: "Cherubi", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/420.png", role: 'bishop' }
                ],
                knights: [
                    { id: 470, name: "Leafeon", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/470.png", role: 'knight' },
                    { id: 470, name: "Leafeon", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/470.png", role: 'knight' }
                ],
                rooks: [
                    { id: 492, name: "Shaymin", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/492.png", role: 'rook' },
                    { id: 492, name: "Shaymin", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/492.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 102, name: "Exeggcute", type: "grass", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/102.png", role: 'pawn' })
            },
            archaludon: {
                king: { ...starterPokemon[3], role: 'king' },
                queen: { id: 373, name: "Salamence", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/373.png", role: 'queen' },
                bishops: [
                    { id: 978, name: "Tatsugiri", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/978.png", role: 'bishop' },
                    { id: 978, name: "Tatsugiri", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/978.png", role: 'bishop' }
                ],
                knights: [
                    { id: 334, name: "Altaria", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/334.png", role: 'knight' },
                    { id: 334, name: "Altaria", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/334.png", role: 'knight' }
                ],
                rooks: [
                    { id: 443, name: "Gible", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/443.png", role: 'rook' },
                    { id: 443, name: "Gible", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/443.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 885, name: "Dreepy", type: "dragon", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/885.png", role: 'pawn' })
            },
            mewtwo: {
                king: { ...starterPokemon[4], role: 'king' },
                queen: { id: 282, name: "Gardevoir", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/282.png", role: 'queen' },
                bishops: [
                    { id: 343, name: "Baltoy", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/343.png", role: 'bishop' },
                    { id: 343, name: "Baltoy", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/343.png", role: 'bishop' }
                ],
                knights: [
                    { id: 686, name: "Inkay", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/686.png", role: 'knight' },
                    { id: 686, name: "Inkay", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/686.png", role: 'knight' }
                ],
                rooks: [
                    { id: 876, name: "Indeedee", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/876.png", role: 'rook' },
                    { id: 876, name: "Indeedee", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/876.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 174, name: "Igglybuff", type: "psychic", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/174.png", role: 'pawn' })
            },
            minun: {
                king: { ...starterPokemon[5], role: 'king' },
                queen: { id: 311, name: "Plusle", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/311.png", role: 'queen' },
                bishops: [
                    { id: 777, name: "Togedemaru", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/777.png", role: 'bishop' },
                    { id: 777, name: "Togedemaru", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/777.png", role: 'bishop' }
                ],
                knights: [
                    { id: 702, name: "Dedenne", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/702.png", role: 'knight' },
                    { id: 702, name: "Dedenne", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/702.png", role: 'knight' }
                ],
                rooks: [
                    { id: 101, name: "Electrode", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/101.png", role: 'rook' },
                    { id: 101, name: "Electrode", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/101.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 403, name: "Shinx", type: "electric", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/403.png", role: 'pawn' })
            },
            gengar: {
                king: { ...starterPokemon[6], role: 'king' },
                queen: { id: 509, name: "Purrloin", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/509.png", role: 'queen' },
                bishops: [
                    { id: 355, name: "Duskull", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/355.png", role: 'bishop' },
                    { id: 355, name: "Duskull", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/355.png", role: 'bishop' }
                ],
                knights: [
                    { id: 353, name: "Shuppet", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/353.png", role: 'knight' },
                    { id: 353, name: "Shuppet", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/353.png", role: 'knight' }
                ],
                rooks: [
                    { id: 622, name: "Golett", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/622.png", role: 'rook' },
                    { id: 622, name: "Golett", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/622.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 971, name: "Greavard", type: "ghost", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/971.png", role: 'pawn' })
            },
            sudowoodo: {
                king: { ...starterPokemon[7], role: 'king' },
                queen: { id: 698, name: "Amaura", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/698.png", role: 'queen' },
                bishops: [
                    { id: 27, name: "Sandshrew", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/27.png", role: 'bishop' },
                    { id: 27, name: "Sandshrew", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/27.png", role: 'bishop' }
                ],
                knights: [
                    { id: 566, name: "Archen", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/566.png", role: 'knight' },
                    { id: 566, name: "Archen", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/566.png", role: 'knight' }
                ],
                rooks: [
                    { id: 104, name: "Cubone", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/104.png", role: 'rook' },
                    { id: 104, name: "Cubone", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/104.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 529, name: "Drilbur", type: "rock", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/529.png", role: 'pawn' })
            },
            snorlax: {
                king: { ...starterPokemon[8], role: 'king' },
                queen: { id: 396, name: "Starly", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/396.png", role: 'queen' },
                bishops: [
                    { id: 162, name: "Furret", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/162.png", role: 'bishop' },
                    { id: 162, name: "Furret", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/162.png", role: 'bishop' }
                ],
                knights: [
                    { id: 52, name: "Meowth", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/52.png", role: 'knight' },
                    { id: 52, name: "Meowth", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/52.png", role: 'knight' }
                ],
                rooks: [
                    { id: 572, name: "Minccino", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/572.png", role: 'rook' },
                    { id: 572, name: "Minccino", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/572.png", role: 'rook' }
                ],
                pawns: Array(8).fill({ id: 133, name: "Eevee", type: "normal", imageUrl: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/133.png", role: 'pawn' })
            }
        };


        // Game state
        let playerName = '';
        let selectedKing = null;
        let computerKing = null;
        let board = Array(8).fill(null).map(() => Array(8).fill(null));
        let selectedPiece = null;
        let isPlayerTurn = true;
        let gameStatus = '';
        let lastMove = null;
        let difficulty = 'medium';
        let currentPromotionPosition = null;
        let playerCaptured = [];
        let computerCaptured = [];

        // DOM elements
        const nameScreen = document.getElementById('name-screen');
        const pokemonSelectionScreen = document.getElementById('pokemon-selection-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameStatusElement = document.getElementById('game-status');
        const chessBoard = document.getElementById('chess-board');
        const pokemonSelection = document.getElementById('pokemon-selection');
        const congratsModal = document.getElementById('congrats-modal');
        const resultTitle = document.getElementById('result-title');
        const resultMessage = document.getElementById('result-message');
        const playerNameInput = document.getElementById('player-name');
        const startGameBtn = document.getElementById('start-game');
        const playAgainBtn = document.getElementById('play-again');
        const difficultySelect = document.getElementById('difficulty');
        const promotionModal = document.getElementById('promotion-modal');
        const evolutionOptions = document.getElementById('evolution-options');
        const advantageDisplay = document.getElementById('advantage-display');

        // Initialize the game
        function init() {
            renderPokemonSelection();
            setupEventListeners();
        }

        function setupEventListeners() {
            startGameBtn.addEventListener('click', () => {
                playerName = playerNameInput.value.trim() || 'Trainer';
                difficulty = difficultySelect.value;
                nameScreen.classList.add('hidden');
                pokemonSelectionScreen.classList.remove('hidden');
            });

            playAgainBtn.addEventListener('click', () => {
                window.location.reload();
            });
        }

        function renderPokemonSelection() {
            pokemonSelection.innerHTML = '';
            starterPokemon.forEach(pokemon => {
                const option = document.createElement('div');
                option.className = 'pokemon-option';
                option.innerHTML = `
                    <img src="${pokemon.imageUrl}" alt="${pokemon.name}">
                    <h3>${pokemon.name}</h3>
                    <p>${pokemon.type} type</p>
                `;
                option.addEventListener('click', () => selectPokemonKing(pokemon));
                pokemonSelection.appendChild(option);
            });
        }

        function selectPokemonKing(pokemon) {
            selectedKing = pokemon;
            
            // Select random computer king (different from player's)
            const availableKings = starterPokemon.filter(p => p.id !== pokemon.id);
            computerKing = availableKings[Math.floor(Math.random() * availableKings.length)];
            
            initializeBoard();
            pokemonSelectionScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
        }

        function initializeBoard() {
            const playerTeam = pokemonTeams[selectedKing.name.toLowerCase()];
            const computerTeam = pokemonTeams[computerKing.name.toLowerCase()];
            
            // Clear the board
            board = Array(8).fill(null).map(() => Array(8).fill(null));
            lastMove = null;
            playerCaptured = [];
            computerCaptured = [];
            
            // Set up player's pieces (bottom)
            board[7][4] = { ...playerTeam.king, side: 'player' };
            board[7][3] = { ...playerTeam.queen, side: 'player' };
            board[7][2] = { ...playerTeam.bishops[0], side: 'player' };
            board[7][5] = { ...playerTeam.bishops[1], side: 'player' };
            board[7][1] = { ...playerTeam.knights[0], side: 'player' };
            board[7][6] = { ...playerTeam.knights[1], side: 'player' };
            board[7][0] = { ...playerTeam.rooks[0], side: 'player' };
            board[7][7] = { ...playerTeam.rooks[1], side: 'player' };
            for (let i = 0; i < 8; i++) {
                board[6][i] = { ...playerTeam.pawns[i], side: 'player' };
            }

            // Set up computer's pieces (top)
            board[0][4] = { ...computerTeam.king, side: 'computer' };
            board[0][3] = { ...computerTeam.queen, side: 'computer' };
            board[0][2] = { ...computerTeam.bishops[0], side: 'computer' };
            board[0][5] = { ...computerTeam.bishops[1], side: 'computer' };
            board[0][1] = { ...computerTeam.knights[0], side: 'computer' };
            board[0][6] = { ...computerTeam.knights[1], side: 'computer' };
            board[0][0] = { ...computerTeam.rooks[0], side: 'computer' };
            board[0][7] = { ...computerTeam.rooks[1], side: 'computer' };
            for (let i = 0; i < 8; i++) {
                board[1][i] = { ...computerTeam.pawns[i], side: 'computer' };
            }

            renderBoard();
            updateGameStatus();
            updateCapturedDisplay();
            updateAdvantageDisplay();
        }

        function renderBoard() {
            chessBoard.innerHTML = '';
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const square = document.createElement('div');
                    square.className = `square ${(x + y) % 2 === 0 ? 'light' : 'dark'}`;
                    
                    // Highlight last move
                    if (lastMove && 
                        ((lastMove.from.x === x && lastMove.from.y === y) || 
                         (lastMove.to.x === x && lastMove.to.y === y))) {
                        square.classList.add('last-move');
                    }
                    
                    // Highlight selected piece
                    if (selectedPiece && selectedPiece.x === x && selectedPiece.y === y) {
                        square.classList.add('selected');
                    }
                    
                    const piece = board[y][x];
                    if (piece) {
                        const pieceImg = document.createElement('img');
                        pieceImg.src = piece.imageUrl;
                        pieceImg.alt = piece.name;
                        pieceImg.className = 'piece';
                        const roleText = piece.promoted ? 'Evolved Pawn' : piece.role;
                        pieceImg.title = `${piece.name} (${roleText})`;
                        square.appendChild(pieceImg);
                    }
                    
                    square.addEventListener('click', () => handleSquareClick(x, y));
                    chessBoard.appendChild(square);
                }
            }
            
            // Highlight kings in check
            highlightKingsInCheck();
        }

        function highlightKingsInCheck() {
            // Find player king
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const piece = board[y][x];
                    if (piece?.role === 'king' && piece.side === 'player' && isKingInCheck(board, true)) {
                        const square = chessBoard.children[y * 8 + x];
                        square.classList.add('in-check');
                    }
                    if (piece?.role === 'king' && piece.side === 'computer' && isKingInCheck(board, false)) {
                        const square = chessBoard.children[y * 8 + x];
                        square.classList.add('in-check');
                    }
                }
            }
        }

        function handleSquareClick(x, y) {
            if (!isPlayerTurn || gameStatus.includes('Checkmate') || gameStatus.includes('Stalemate')) return;

            if (!selectedPiece) {
                const piece = board[y][x];
                if (piece && piece.side === 'player') {
                    selectedPiece = { x, y };
                    renderBoard();
                }
            } else {
                const piece = board[selectedPiece.y][selectedPiece.x];
                if (piece && isValidMove(selectedPiece, { x, y }, piece, board, isPlayerTurn)) {
                    // Make the move
                    const newBoard = board.map(row => [...row]);
                    newBoard[y][x] = newBoard[selectedPiece.y][selectedPiece.x];
                    newBoard[selectedPiece.y][selectedPiece.x] = null;
                    
                    // Check if this move would put our own king in check
                    if (isKingInCheck(newBoard, true)) {
                        selectedPiece = null;
                        renderBoard();
                        return;
                    }
                    
                    // Check if capturing the king
                    const targetPiece = board[y][x];
                    if (targetPiece && targetPiece.role === 'king') {
                        // Game over - player wins
                        board[y][x] = board[selectedPiece.y][selectedPiece.x];
                        board[selectedPiece.y][selectedPiece.x] = null;
                        
                        gameStatus = `${playerName} captured the king and wins!`;
                        resultTitle.textContent = 'ðŸŽ‰ Congratulations! ðŸŽ‰';
                        resultMessage.textContent = gameStatus;
                        congratsModal.classList.remove('hidden');
                        return;
                    }
                    
                    // Check for pawn promotion
                    if (piece.role === 'pawn' && (y === 0 || y === 7)) {
                        const evolutions = pokemonEvolutions[piece.id];
                        if (evolutions) {
                            // Execute the move first
                            board[y][x] = board[selectedPiece.y][selectedPiece.x];
                            board[selectedPiece.y][selectedPiece.x] = null;
                            currentPromotionPosition = { x, y };
                            showPromotionModal(evolutions);
                            return;
                        }
                    }
                    
                    // Check for capture
                    if (targetPiece) {
                        playerCaptured.push(targetPiece);
                        updateCapturedDisplay();
                    }
                    
                    // Execute the move
                    board[y][x] = board[selectedPiece.y][selectedPiece.x];
                    board[selectedPiece.y][selectedPiece.x] = null;
                    
                    // Store last move for highlighting
                    lastMove = {
                        from: { x: selectedPiece.x, y: selectedPiece.y },
                        to: { x, y }
                    };
                    
                    selectedPiece = null;
                    isPlayerTurn = false;
                    renderBoard();
                    updateGameStatus();
                    updateAdvantageDisplay();
                    
                    // Computer makes a move after a short delay
                    setTimeout(makeComputerMove, 500);
                } else {
                    selectedPiece = null;
                    renderBoard();
                }
            }
        }

        function updateCapturedDisplay() {
            const playerCapturedDiv = document.getElementById('player-captured');
            const computerCapturedDiv = document.getElementById('computer-captured');
            
            playerCapturedDiv.innerHTML = playerCaptured
                .map(p => {
                    const roleText = p.promoted ? `Evolved ${p.name}` : `${p.name} ${p.role}`;
                    return `<img src="${p.imageUrl}" class="captured-piece-img" title="${roleText}">`;
                })
                .join('');
                
            computerCapturedDiv.innerHTML = computerCaptured
                .map(p => {
                    const roleText = p.promoted ? `Evolved ${p.name}` : `${p.name} ${p.role}`;
                    return `<img src="${p.imageUrl}" class="captured-piece-img" title="${roleText}">`;
                })
                .join('');
        }

        function updateAdvantageDisplay() {
            const playerPoints = calculatePoints('player');
            const computerPoints = calculatePoints('computer');
            const difference = playerPoints - computerPoints;
            const percentage = (difference / 80) * 100;
            
            if (percentage > 0) {
                advantageDisplay.textContent = `${Math.abs(percentage).toFixed(1)}% Advantage for ${playerName}`;
            } else if (percentage < 0) {
                advantageDisplay.textContent = `${Math.abs(percentage).toFixed(1)}% Advantage for Computer`;
            } else {
                advantageDisplay.textContent = 'Equal Advantage';
            }
        }

        function calculatePoints(side) {
            let points = 0;
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const piece = board[y][x];
                    if (piece && piece.side === side) {
                        points += getPieceValue(piece);
                    }
                }
            }
            return points;
        }

        function showPromotionModal(evolutions) {
            evolutionOptions.innerHTML = '';
            
            evolutions.forEach(evo => {
                const option = document.createElement('div');
                option.className = 'pokemon-option';
                option.innerHTML = `
                    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${evo.id}.png" 
                         alt="${evo.name}"
                         data-id="${evo.id}">
                    <h3>${evo.name}</h3>
                `;
                option.addEventListener('click', function() {
                    document.querySelectorAll('#evolution-options .pokemon-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
                evolutionOptions.appendChild(option);
            });

            // Clear previous event listeners
            const typeOptions = document.querySelectorAll('.type-option');
            typeOptions.forEach(btn => {
                btn.replaceWith(btn.cloneNode(true));
            });

            // Add new event listeners
            document.querySelectorAll('.type-option').forEach(btn => {
                btn.addEventListener('click', function() {
                    const selectedEvolution = document.querySelector('#evolution-options .selected');
                    if (selectedEvolution) {
                        const img = selectedEvolution.querySelector('img');
                        completePromotion({
                            id: parseInt(img.dataset.id),
                            name: img.alt,
                        }, this.dataset.type);
                    }
                });
            });

            promotionModal.classList.remove('hidden');
        }

        function completePromotion(evolution, pieceType) {
            promotionModal.classList.add('hidden');

            const piece = board[currentPromotionPosition.y][currentPromotionPosition.x];
            piece.id = evolution.id;
            piece.name = evolution.name;
            piece.role = pieceType;
            piece.promoted = true;
            piece.imageUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${evolution.id}.png`;

            renderBoard();
            
            lastMove = {
                from: { x: selectedPiece.x, y: selectedPiece.y },
                to: { x: currentPromotionPosition.x, y: currentPromotionPosition.y }
            };
            
            selectedPiece = null;
            isPlayerTurn = false;
            updateGameStatus();
            updateAdvantageDisplay();
            
            setTimeout(makeComputerMove, 500);
        }

        function makeComputerMove() {
            // First check if game is already over
            if (gameStatus.includes('Checkmate') || gameStatus.includes('Stalemate')) return;
            
            // Find all possible computer moves that don't put king in check
            const possibleMoves = [];
            for (let fromY = 0; fromY < 8; fromY++) {
                for (let fromX = 0; fromX < 8; fromX++) {
                    const piece = board[fromY][fromX];
                    if (!piece || piece.side !== 'computer') continue;
                    
                    for (let toY = 0; toY < 8; toY++) {
                        for (let toX = 0; toX < 8; toX++) {
                            if (isValidMove(
                                { x: fromX, y: fromY },
                                { x: toX, y: toY },
                                piece,
                                board,
                                false // isPlayerTurn = false for computer
                            )) {
                                // Check if this move would put computer king in check
                                const tempBoard = board.map(row => [...row]);
                                tempBoard[toY][toX] = tempBoard[fromY][fromX];
                                tempBoard[fromY][fromX] = null;
                                
                                if (!isKingInCheck(tempBoard, false)) {
                                    possibleMoves.push({
                                        from: { x: fromX, y: fromY },
                                        to: { x: toX, y: toY },
                                        piece: piece,
                                        targetPiece: board[toY][toX]
                                    });
                                }
                            }
                        }
                    }
                }
            }
            
            // If no moves available, it's stalemate or checkmate
            if (possibleMoves.length === 0) {
                updateGameStatus();
                return;
            }
            
            // Evaluate moves based on difficulty
            let bestMove = null;
            let bestScore = -Infinity;
            
            for (const move of possibleMoves) {
                let score = 0;
                
                // Check if this would capture the king (instant win)
                if (move.targetPiece && move.targetPiece.role === 'king') {
                    bestMove = move;
                    break;
                }
                
                // Check if this would put player in checkmate
                const newBoard = board.map(row => [...row]);
                newBoard[move.to.y][move.to.x] = newBoard[move.from.y][move.from.x];
                newBoard[move.from.y][move.from.x] = null;
                
                if (isCheckmate(newBoard, true)) {
                    bestMove = move;
                    break;
                }
                
                // Check if computer is in check and this move gets out of check
                if (isKingInCheck(board, false)) {
                    const tempBoard = board.map(row => [...row]);
                    tempBoard[move.to.y][move.to.x] = tempBoard[move.from.y][move.from.x];
                    tempBoard[move.from.y][move.from.x] = null;
                    
                    if (!isKingInCheck(tempBoard, false)) {
                        score += 50; // High priority to get out of check
                    }
                }
                
                // Add value of captured piece
                if (move.targetPiece) {
                    score += getPieceValue(move.targetPiece) * 10;
                }
                
                // Add positional score based on piece type
                score += evaluatePosition(move, board);
                
                // Add randomness based on difficulty
                let randomness = 0;
                if (difficulty === 'easy') {
                    randomness = Math.random() * 20 - 10; // -10 to 10
                } else if (difficulty === 'medium') {
                    randomness = Math.random() * 10 - 5; // -5 to 5
                } else {
                    randomness = Math.random() * 2 - 1; // -1 to 1
                }
                
                score += randomness;
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            }
            
            // Execute the best move found
            if (bestMove) {
                setTimeout(() => {
                    // Check for pawn promotion
                    if (bestMove.piece.role === 'pawn' && 
                       (bestMove.to.y === 0 || bestMove.to.y === 7)) {
                        const evolutions = pokemonEvolutions[bestMove.piece.id];
                        if (evolutions) {
                            board[bestMove.to.y][bestMove.to.x] = {
                                ...evolutions[0],
                                role: 'queen',
                                side: 'computer',
                                promoted: true,
                                imageUrl: `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${evolutions[0].id}.png`
                            };
                        }
                    }

                    // Check for capture
                    if (bestMove.targetPiece) {
                        computerCaptured.push(bestMove.targetPiece);
                        updateCapturedDisplay();
                    }

                    // Check if capturing the king
                    if (bestMove.targetPiece && bestMove.targetPiece.role === 'king') {
                        // Game over - computer wins
                        board[bestMove.to.y][bestMove.to.x] = board[bestMove.from.y][bestMove.from.x];
                        board[bestMove.from.y][bestMove.from.x] = null;
                        
                        gameStatus = `Computer captured the king and wins!`;
                        resultTitle.textContent = 'Game Over';
                        resultMessage.textContent = gameStatus;
                        congratsModal.classList.remove('hidden');
                        return;
                    }
                    
                    // Execute the move
                    board[bestMove.to.y][bestMove.to.x] = board[bestMove.from.y][bestMove.from.x];
                    board[bestMove.from.y][bestMove.from.x] = null;
                    
                    // Store last move for highlighting
                    lastMove = {
                        from: { x: bestMove.from.x, y: bestMove.from.y },
                        to: { x: bestMove.to.x, y: bestMove.to.y }
                    };
                    
                    isPlayerTurn = true;
                    renderBoard();
                    updateGameStatus();
                    updateAdvantageDisplay();
                }, 500); // Small delay for better UX
            }
        }
        
        function evaluatePosition(move, board) {
            // Simple positional evaluation
            let score = 0;
            
            // Encourage pawns to advance
            if (move.piece.role === 'pawn') {
                score += (move.piece.side === 'computer' ? move.to.y : 7 - move.to.y) * 0.5;
            }
            
            // Encourage knights to move toward center
            if (move.piece.role === 'knight') {
                const centerX = 3.5;
                const centerY = 3.5;
                const distanceFromCenter = Math.sqrt(
                    Math.pow(move.to.x - centerX, 2) + 
                    Math.pow(move.to.y - centerY, 2)
                );
                score += (4 - distanceFromCenter) * 0.5;
            }
            
            // Encourage pieces to control center squares
            const centerSquares = [[3,3], [3,4], [4,3], [4,4]];
            for (const [cx, cy] of centerSquares) {
                if (move.to.x === cx && move.to.y === cy) {
                    score += 1;
                }
            }
            
            return score;
        }
        
        function getPieceValue(piece) {
            const values = {
                pawn: 1,
                knight: 3,
                bishop: 3,
                rook: 5,
                queen: 10,
                king: 0 // King doesn't count for score
            };
            return values[piece.role] || 0;
        }

        function updateGameStatus() {
            // Check for checkmate
            if (isCheckmate(board, isPlayerTurn)) {
                const winner = isPlayerTurn ? 'Computer' : playerName;
                gameStatus = `Checkmate! ${winner} wins!`;
                
                resultTitle.textContent = winner === playerName ? 'ðŸŽ‰ Congratulations! ðŸŽ‰' : 'Game Over';
                resultMessage.textContent = gameStatus;
                congratsModal.classList.remove('hidden');
                return;
            }
            
            // Check for stalemate
            if (isStalemate(board, isPlayerTurn)) {
                gameStatus = `Stalemate! It's a draw!`;
                resultTitle.textContent = 'Game Over';
                resultMessage.textContent = gameStatus;
                congratsModal.classList.remove('hidden');
                return;
            }
            
            // Check for check
            if (isKingInCheck(board, isPlayerTurn)) {
                gameStatus = `${isPlayerTurn ? playerName : 'Computer'} is in check!`;
            } else {
                gameStatus = `${isPlayerTurn ? `${playerName}'s turn` : 'Computer is thinking...'}`;
            }
            
            gameStatusElement.textContent = gameStatus;
        }

        function isStalemate(board, isPlayerTurn) {
            // Check if the current player has no legal moves and is not in check
            if (isKingInCheck(board, isPlayerTurn)) return false;
            
            for (let fromY = 0; fromY < 8; fromY++) {
                for (let fromX = 0; fromX < 8; fromX++) {
                    const piece = board[fromY][fromX];
                    if (!piece || piece.side !== (isPlayerTurn ? 'player' : 'computer')) continue;
                    
                    for (let toY = 0; toY < 8; toY++) {
                        for (let toX = 0; toX < 8; toX++) {
                            if (isValidMove(
                                { x: fromX, y: fromY },
                                { x: toX, y: toY },
                                piece,
                                board,
                                isPlayerTurn
                            )) {
                                // Check if this move would not put king in check
                                const tempBoard = board.map(row => [...row]);
                                tempBoard[toY][toX] = tempBoard[fromY][fromX];
                                tempBoard[fromY][fromX] = null;
                                
                                if (!isKingInCheck(tempBoard, isPlayerTurn)) {
                                    return false; // Found at least one valid move
                                }
                            }
                        }
                    }
                }
            }
            
            return true; // No valid moves found
        }

        function isValidMove(from, to, piece, board, isPlayerTurn) {
            if (!piece || !piece.role || piece.side === undefined) return false;
            
            if ((piece.side === 'player') !== isPlayerTurn) return false;

            const targetPiece = board[to.y][to.x];
            if (targetPiece && targetPiece.side === piece.side) return false;

            const dx = Math.abs(to.x - from.x);
            const dy = Math.abs(to.y - from.y);
            
            switch (piece.role) {
                case 'pawn':
                    const direction = piece.side === 'player' ? -1 : 1;
                    const startRank = piece.side === 'player' ? 6 : 1;
                    
                    if (from.x === to.x && !targetPiece) {
                        if (to.y - from.y === direction) return true;
                        if (from.y === startRank && to.y - from.y === 2 * direction) {
                            return !board[from.y + direction][from.x];
                        }
                    }
                    
                    if (dx === 1 && dy === 1 && to.y - from.y === direction) {
                        return targetPiece !== null;
                    }
                    return false;
                
                case 'knight':
                    return (dx === 2 && dy === 1) || (dx === 1 && dy === 2);
                
                case 'bishop':
                    if (dx !== dy) return false;
                    return !isPieceBetween(from, to, board);
                
                case 'rook':
                    if (dx !== 0 && dy !== 0) return false;
                    return !isPieceBetween(from, to, board);
                
                case 'queen':
                    if (dx !== dy && dx !== 0 && dy !== 0) return false;
                    return !isPieceBetween(from, to, board);
                
                case 'king':
                    return dx <= 1 && dy <= 1;
                
                default:
                    return false;
            }
        }

        function isPieceBetween(from, to, board) {
            const dx = Math.sign(to.x - from.x);
            const dy = Math.sign(to.y - from.y);
            let x = from.x + dx;
            let y = from.y + dy;
            
            while (x !== to.x || y !== to.y) {
                if (board[y][x]) return true;
                x += dx;
                y += dy;
            }
            
            return false;
        }

        function isKingInCheck(board, isPlayerKing) {
            let kingPos = null;
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const piece = board[y][x];
                    if (piece?.role === 'king' && piece.side === (isPlayerKing ? 'player' : 'computer')) {
                        kingPos = { x, y };
                        break;
                    }
                }
                if (kingPos) break;
            }
            
            if (!kingPos) return false;
            
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    const piece = board[y][x];
                    if (piece && piece.side !== (isPlayerKing ? 'player' : 'computer')) {
                        if (isValidMove({ x, y }, kingPos, piece, board, !isPlayerKing)) {
                            return true;
                        }
                    }
                }
            }
            
            return false;
        }

        function isCheckmate(board, isPlayerTurn) {
            if (!isKingInCheck(board, isPlayerTurn)) return false;
            
            for (let fromY = 0; fromY < 8; fromY++) {
                for (let fromX = 0; fromX < 8; fromX++) {
                    const piece = board[fromY][fromX];
                    if (!piece || piece.side !== (isPlayerTurn ? 'player' : 'computer')) continue;
                    
                    for (let toY = 0; toY < 8; toY++) {
                        for (let toX = 0; toX < 8; toX++) {
                            if (!isValidMove(
                                { x: fromX, y: fromY },
                                { x: toX, y: toY },
                                piece,
                                board,
                                isPlayerTurn
                            )) continue;
                            
                            const newBoard = board.map(row => [...row]);
                            newBoard[toY][toX] = newBoard[fromY][fromX];
                            newBoard[fromY][fromX] = null;
                            
                            if (!isKingInCheck(newBoard, isPlayerTurn)) {
                                return false;
                            }
                        }
                    }
                }
            }
            
            return true;
        }

        // Start the game
        init();
    </script>
</body>
</html>